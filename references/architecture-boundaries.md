# 架构边界与低耦合策略（Architecture Boundaries）

目标：让“代码放哪、依赖怎么走、如何复用而不堆 utils”变成可执行规则，减少重复与耦合，提升可读性与可维护性。

---

## 1) Boundary Map（边界地图）

在方案设计阶段（或重大改动前）建立边界地图，至少回答：
- 模块/包边界是什么？（按目录/领域/服务/包管理单元）
- 哪些是稳定层（Domain/Core），哪些是易变层（UI/Adapter/Infra）？
- 允许的依赖方向是什么？（例如：UI → App → Domain → Infra）
- 每个模块对外暴露的“公共入口”是什么？（避免横向 import 深层文件）

边界地图建议写入 `how.md` 的 `## 边界与依赖` 章节。

---

## 2) 放置规则（避免横向耦合）

默认策略（可按项目调整）：
- **业务语义**放 Domain/Core（纯逻辑、可测试）
- **用例编排**放 Application（调用 Domain、处理事务/流程）
- **I/O 与第三方**放 Adapter/Infrastructure（DB/HTTP/FS/SDK）
- **UI/接口层**只做输入输出转换，不写业务规则

禁止模式（高耦合信号）：
- UI 直接 import Infra
- 业务规则塞进 `utils/`、`common/` 且无领域命名
- 跨模块读写内部数据结构而无接口

---

## 3) 复用与去重（不制造新耦合）

建立抽象前先问三件事：
1. 这段逻辑是否属于某个明确领域？（能否用领域名命名）
2. 复用是否会引入反向依赖或跨层依赖？（若会，宁可复制并保持局部）
3. 未来是否真的会增长？（否则避免过早抽象）

建议阈值：
- **重复≥2处 + 预计继续增长** → 可以抽象
- **重复≥2处但边界不同**（跨层/跨服务）→ 优先保持局部实现，避免耦合

---

## 4) 依赖与耦合检查（轻量）

在实现阶段做一次轻量检查：
- 新增依赖是否必要？能否通过已有抽象实现？
- 是否出现跨层 import？是否形成潜在循环依赖？
- 是否引入“万能工具类/万能 util”？（若是，改为领域模块）

检查结果建议写入 `how.md` 的“复用与去重策略”或“重构范围与不变量”。

