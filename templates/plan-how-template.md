# 技术设计: [功能名称]

## 技术方案

### 核心技术
- [语言/框架/库]

### 实现要点
- [关键逻辑1]
- [关键逻辑2]

## 假设与不确定性
- **关键假设:** [≤5条]
- **待确认:** [需要用户/环境确认的点]
- **替代路径:** [如假设不成立时的备选方案]

## 外部知识与版本绑定（如使用）

> 细则见 `references/external-knowledge.md`。不用外部资料时可省略本节。

- **使用目的:** [为什么需要外部资料：新库/版本差异/安全建议/排错等]
- **来源与结论:**
  - [SRC:TOOL] web/mcp: [url/uri + accessed + version] | claim: [...] | scope: [...] | expires: [...] | verify: [...]
- **本地验证证据:** [对应的命令/测试/输出摘要；无法验证则写入 task.md 的“待确认/假设”区]

## 中期落盘（上下文快照）

> 目标：在长会话/多失败/易中断时防跑偏。只固化可追溯事实；推断隔离到待确认区；细则见 `references/context-snapshot.md`。

- **落点:** `task.md##上下文快照`
- **触发:** 关键决策/需求变更/阻断失败/会话可能中断/最终输出前（Review 前必须最新）
- **来源标签:** `[SRC:USER|CODE|TOOL|INFER|TODO]`（推断不得进入事实区）

## 边界与依赖
- **模块边界:** [按目录/领域/服务划分]
- **依赖方向:** [允许依赖的方向，例如 UI→App→Domain→Infra]
- **公共入口:** [每个模块对外暴露的入口文件/包]

## 复用与去重策略
- **复用检索结果:** [已有能力/相似实现位置]
- **去重策略:** [何处抽象/何处保持局部，及理由]
- **避免 utils 膨胀:** [领域命名与边界约束]

## 重构范围与不变量
- **允许的顺手重构:** [命名/提取函数/收敛错误处理/去重等]
- **不变量:** [行为/接口/性能/兼容要求]
- **禁止触碰:** [明确不改的模块/接口/数据层]

## 执行域声明（Allow/Deny）

> 用途：执行前明确修改边界，失败时避免扩大范围自证；细则见 `references/execution-guard.md`。

- **Allow（允许修改）:** [文件/目录白名单]
- **Deny（禁止修改）:** [明确不碰的模块/目录/协议层]
- **New Files（允许新增文件）:** [否 / 是（限定目录：...）]
- **Refactor（允许顺手重构）:** [否 / 是（绑定预算与不变量）]

## 跨层一致性（如触发）

> 触发与清单：`references/checklist-triggers.md` / `references/cross-layer-checklist.md`。

- **受影响层与入口:** [UI/API/Service/DB/CLI/... + 入口点]
- **契约变化:** [DTO/schema/response shape/error code 等]
- **兼容策略:** [向后兼容/迁移/降级/特性开关]
- **多消费者清点:** [调用点/客户端/文档/测试]
- **验证:** [覆盖跨层路径的测试/脚本/手动步骤（可复现）]

## 架构设计
<!-- 如有架构变更 -->
```mermaid
flowchart TD
    [图表代码]
```

## 架构决策 ADR
<!-- 如涉及架构决策，否则省略 -->
### ADR-[编号]: [决策标题]
**上下文:** [背景与问题]
**决策:** [核心决策]
**理由:** [原因]
**替代方案:** [方案] → 拒绝原因: [原因]
**影响:** [后果与风险]

## API设计
<!-- 如有API变更 -->
### [METHOD] [路径]
- **请求:** [结构]
- **响应:** [结构]

## 数据模型
<!-- 如有数据变更 -->
```sql
[SQL或Schema代码]
```

## 安全与性能
- **安全:** [措施]
- **性能:** [优化]

## 测试与部署
- **测试:** [策略]
- **部署:** [流程]
- **质量门禁:** [fmt/lint/typecheck/test/security 的执行顺序与阻断规则，命令来自 project.md 的“项目能力画像”]
